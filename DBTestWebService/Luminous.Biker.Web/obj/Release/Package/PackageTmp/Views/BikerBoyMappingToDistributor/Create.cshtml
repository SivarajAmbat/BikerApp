@model Luminous.Biker.Web.Models.BikerDistMapping
<script src="~/Script/jquery.min.js"></script>
@{
    ViewBag.Title = "Create";
}

<h2 class="col-lg-8 col-xs-8 col-md-8 col-sm-12 col-lg-offset-2 col-xs-offset-2 col-md-offset-2">Create/Update Distributor-Biker Mapping</h2>

<div class="col-lg-8 col-xs-8 col-md-8 col-sm-12 col-lg-offset-2 col-xs-offset-2 col-md-offset-2">
    @Html.ActionLink("Back to List", "Index")
</div>
<div class="col-lg-10 col-xs-10 col-md-10 col-sm-12 col-lg-offset-1 col-xs-offset-1 col-md-offset-1">
    <div class="col-md-5 divChblLeft">
        @Html.Partial("~/Views/BikerBoyMappingToDistributor/_DistributorRadio.cshtml")
    </div>
    <div class="col-md-1 divChblCenter">
        <div class="loader" style="display:none; text-align:center; vertical-align:central;">
            <img src="/Images/6-1.gif" />
        </div>
        <button type="button" disabled class="btn btn-primary btnUpdateMapping" style="position:absolute; bottom:1px; padding:6px;">Update</button>
    </div>
    <div class="col-md-5 divChblRight">
        @Html.Partial("~/Views/BikerBoyMappingToDistributor/_BikerCheck.cshtml")
    </div>
</div>



<script type="text/javascript">
    $(document).ready(function () {
        $('.rdbDistId').click(function () {
            $('.btnUpdateMapping').removeAttr('disabled')
            var distId = $(this).parent().find('#hndDistId').val();
            $.ajax({
                url: "/BikerBoyMappingToDistributor/GetMappedBikerByDistributorId/?distId=" + distId,
                method: "GET",
                //data: JSON.stringify({ 'distId': distId }),
                //contentType: "application/json",
                //dataType: "json",
                success: function (result) {
                    if (result != null && result.length > 0) {
                        var bikerMappedIds = $.parseJSON(result);
                        var allBikerCheckBox = $('.divChblRight .chbBikerMain');
                        $.each(allBikerCheckBox, function (index, chbDivMain) {
                            $(chbDivMain).find('.chbBikerId').prop("checked", false);
                            if (chbDivMain != null && $.inArray(parseInt($(chbDivMain).find('#hndBikerId').val()), bikerMappedIds) > -1) {
                                $(chbDivMain).find('.chbBikerId').prop("checked", true);
                            }
                        });
                    }

                },
                error: function (data) {
                    alert("Some error occured. Please try again");
                },
                beforeSend: function () {
                    $('.loader').show();
                },
                complete: function () {
                    $('.loader').hide();
                },
            });
        });

        $('.btnUpdateMapping').click(function () {
            var allBikerCheckBoxChecked = $('.divChblRight .chbBikerMain');
            var distRadioChecked = $('.divChblLeft .chbDistMain');

            var distId = '';
            $.each(distRadioChecked, function (index, rdbDivMain) {
                if (rdbDivMain != null && $(rdbDivMain).find('.rdbDistId').is(':checked')) {
                    distId = $(rdbDivMain).find('#hndDistId').val();
                    return false;
                }
            });

        var arrBikerIdChecked = Array();

        $.each(allBikerCheckBoxChecked, function (index, chbDivMain) {
            if (chbDivMain != null && $(chbDivMain).find('.chbBikerId').is(':checked'))
            {
                arrBikerIdChecked.push($(chbDivMain).find('#hndBikerId').val());
            }
        });


        $.ajax({
            url: "/BikerBoyMappingToDistributor/UpdateMappingBikerAndDistributor",
            method: "POST",
            data: JSON.stringify({ 'distId': distId, 'bikerIds' : arrBikerIdChecked }),
            contentType: "application/json",
            dataType: "json",
            success: function (result) {
                if (result != null && result.length > 0) {
                    alert(result);
                }
            },
            error: function (data) {
                alert("Some error occured. Please try again");
            },
            beforeSend: function () {
                $('.loader').show();
            },
            complete: function () {
                $('.loader').hide();
            },
        });


    });
    });
</script>


